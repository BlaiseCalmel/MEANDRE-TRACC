<!DOCTYPE html>
<html lang="fr">
    <head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Abigail</title>
	<script src="https://d3js.org/d3.v6.min.js"></script>
	<script src="//d3js.org/topojson.v1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/geotoolbox" charset="utf-8"></script>
	<style>
         body {
             margin: 0;
             padding: 0;
             display: flex;
             height: 100vh;
             overflow: hidden;
         }

         #menu {
             width: 60px;
             background-color: #333;
             color: #fff;
             padding: 20px;
             box-shadow: 2px 0px 5px rgba(0, 0, 0, 0.5);
             transition: width 0.3s ease;
             position: absolute;
             top: 0;
             bottom: 0;
             z-index: 2;
         }

         #menu.expanded {
             width: 250px;
         }

         #menu-button {
             cursor: pointer;
             z-index: 3;
             position: absolute;
             top: 20px;
             left: 20px;
         }

         #map-container {
             flex: 1;
	     position: relative;
             overflow: hidden;
         }

	</style>
    </head>
    <body>
	<div id="map-container">
            <svg id="geoJSONsvg_france"></svg>
	</div>
	
	<script>
	 
	 
         function toggleMenu() {
             const menu = document.getElementById("menu");
             const menuText = document.getElementById("menu-text");

             if (menu.classList.contains("expanded")) {
                 menu.classList.remove("expanded");
                 menuText.textContent = "M";
             } else {
                 menu.classList.add("expanded");
                 menuText.textContent = "Menu";
             }
         }

	 

	 const k_simplify_initial = 0.02;


	 d3.json('data/france.geo.json')
	   .then(data => {
	       drawGeoJSON_france(geotoolbox.simplify(data, { k: k_simplify_initial, merge: false }));
	   })
	   .catch(error => {
	       console.error("Error loading geojson file :", error);
	   });

	 function drawGeoJSON_france(geoJSONdata_france) {
	     if (geoJSONdata_france) {
		 const width = 700;
		 const height = 700;

		 const backgroundColor = "#EAF2FA";
		 const landColor = "#09A573";
		 const landStroke = "#FCF5E9";

		 const minZoom = 1;
		 const maxZoom = 4.5;
		 
		 const k_simplify_ref = 0.05;
		 let k_simplify;

		 const zoom = d3.zoom()
				.scaleExtent([minZoom, maxZoom])
				.on("zoom", function (event) {
				    k_simplify = k_simplify_ref + (event.transform.k - minZoom)/(maxZoom-minZoom)*(1-k_simplify_ref);
				    redrawMap(k_simplify);
				    svg.attr("transform", event.transform);
				    svg.style("width", width * event.transform.k + "px");
				    svg.style("height", height * event.transform.k + "px");
				});


		 const projection = d3.geoMercator()
				      .scale([2100])
				      .center(geoJSONdata_france.features[0].properties.centroid)
				      .translate([width/2, height/2]);

		 const svg = d3.select("#geoJSONsvg_france")
			       .attr("width", width)
			       .attr("height", height)
			       .call(zoom)
			       .append("g");
		 
		 svg.append("rect")
		    .attr("width", width)
		    .attr("height", height)
		    .attr('fill', backgroundColor);

		 function redrawMap(k) {
		     const simplifiedGeoJSON_france = geotoolbox.simplify(geoJSONdata_france, { k: k, merge: false });

		     svg.selectAll('path')
		        .data(simplifiedGeoJSON_france.features)
		        .join('path')
		        .attr('d', pathGenerator)
		        .attr('fill', landColor)
		        .attr('stroke', landStroke)
		        .attr('stroke-width', 1);
		 }

		 const pathGenerator = d3.geoPath(projection);

		 redrawMap(k_simplify_ref); // Initial map drawing
		 
		 return svg.node();
		 
	     }
	 }
	 
	</script>
    </body>
</html>
